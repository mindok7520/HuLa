/** 말풍선 스타일 */
@mixin bubble {
  @apply w-fit min-h-1em p-[8px_12px] line-height-22px bg-[--bg-bubble] rounded-[2px_18px_18px] custom-shadow;
  max-width: var(--bubble-max-width, 32vw);
  /** 기본값: 그룹 채팅 너비 */
  white-space: pre-wrap;
  /** 공백 문자를 보존하고 정상적으로 줄바꿈하며, 특수 문자를 지원함 */
  word-break: break-word;
  /** 단어 경계에서 줄바꿈을 우선하고, 필요할 경우 단어 내부에서 줄바꿈함 */
  overflow-wrap: anywhere;
  /** 특수 문자를 포함하여 어느 위치에서든 줄바꿈 가능 */
  word-wrap: break-word;
  /** 구형 브라우저 호환성 */
  -webkit-white-space: pre-wrap;
  /** webkit 브라우저 호환성 */
  -webkit-word-break: break-word;
  -webkit-overflow-wrap: anywhere;
  hyphens: auto;
  /** 행 끝에서 긴 단어를 자동으로 끊음 */
  -webkit-hyphens: auto;
  line-height: 1.7;
  line-break: anywhere;

  /** 특수 문자 및 기호를 포함하여 임의의 위치에서 줄바꿈 지원 */
  &.active {
    background-color: var(--bg-bubble-active);
    color: var(--text-color);
  }
}

@mixin float($position: top) {
  @if $position ==bottom {
    @apply fixed z-10 w-fit select-none text-#13987f cursor-pointer;
  }

  @else {
    @apply fixed z-10 top-80px w-fit select-none text-#13987f cursor-pointer;
  }
}

.bubble {
  @include bubble;
}

.bubble-oneself {
  @include bubble;
  @apply rounded-[18px_2px_18px_18px] color-#fff;
  background-color: var(--bg-active-msg);
}

/* 텍스트 선택 시 하이라이트 색상 (전역 ::selection에 의해 덮어씌워지는 것을 방지하기 위해 루트 노드 및 자손 포함) */
.bubble::selection,
.bubble *::selection {
  background: var(--select-bg-color, rgba(19, 152, 127, 0.3));
}

.bubble-oneself::selection,
.bubble-oneself *::selection {
  background: var(--select-bg-color-self, rgba(255, 255, 255, 0.3));
}

.photo-wall {
  @extend .bubble-oneself;
  @apply flex flex-col items-start gap-6px flex-1;
}

.float-header {
  @include float;
}

.float-footer {
  @include float(bottom);
}

.float-box {
  background-color: var(--right-bg-color);
  border-radius: 50px;
  padding: 6px 8px;
  box-shadow: 0 2px 8px 0 rgba(0, 0, 0, 0.16);
  transition: background-color 0.4s cubic-bezier(0.4, 0, 0.2, 1);

  &:hover {
    background-color: var(--float-hover-bg-color);
  }
}

.mac-close:hover {
  svg {
    display: block;
  }
}

/** 플로트 아이콘이 최대치에 도달했을 때의 스타일 */
.max:hover {
  background-color: #f5dce1;
}

/** 답장 말풍선 스타일 */
.reply-bubble {
  @apply text-[--reply-color] rounded-8px p-4px cursor-pointer select-none;

  svg,
  span {
    transition: color 0.4s ease-in-out;
  }

  .reply-avatar {
    filter: grayscale(60%);
    transition: filter 0.4s ease-in-out;
  }

  &:hover {
    .reply-avatar {
      filter: grayscale(0);
    }

    svg {
      color: #13987f;
    }

    span {
      color: var(--reply-hover);
    }
  }

  .content-span {
    @apply max-w-232px w-fit truncate flex-1;
  }

  /** 답장 이미지 카운터 스타일 */
  .reply-img-sub {
    @apply absolute bottom-8px right-6px color-#13987f bg-[--bg-reply-img-count] p-[2px_4px] rounded-6px text-10px;
  }
}

/** 이모티콘 답장 말풍선 스타일 */
.emoji-reply-bubble {
  @apply relative flex-y-center gap-4px rounded-50px p-[4px_8px] cursor-pointer select-none bg-#13987F66 text-14px w-fit border-(1px solid #13987F) custom-shadow;
}

/** 현재 사용자 마크 메시지 스타일 */
.emoji-reply-bubble--active {
  @apply dark:bg-[#fbb99020] bg-[#fbb99030] dark:border-(1px solid #fbb99050) border-(1px solid #fbb99090);
}

/** 답장 내용으로 이동할 때 표시되는 스타일 */
.active-reply {
  background-color: var(--right-chat-reply-active-color);
  border-radius: 8px;
  margin: 0 8px;
  transition: all 0.4s ease-in-out;
}

/** 답장 내용으로 이동할 때의 퇴장 애니메이션 */
.reply-exit {
  margin: 0;
  background-color: inherit;
  border-radius: 0;
  transition: all 0.4s ease-in-out;
}

/** 번역 말풍선 스타일 */
.translated-text {
  font-size: 12px;
  padding: 4px 8px;
  border-radius: 12px;
  background-color: var(--bg-translate-bubble);
  line-height: 22px;
  margin-top: 6px;
  max-width: var(--bubble-max-width);
  width: fit-content;
}

/** 타임스탬프 표시 시 애니메이션 (개인 채팅) */
.fade-single-enter-active,
.fade-single-leave-active {
  transition: opacity 0.4s ease-in-out;
}

.fade-single-enter-from,
.fade-single-leave-to {
  opacity: 0;
}

/** 타임스탬프 표시 시 애니메이션 (그룹 채팅) */
.fade-group-enter-active,
.fade-group-leave-active {
  transition: opacity 0.4s ease-in-out;
}

.fade-group-enter-from,
.fade-group-leave-to {
  opacity: 0;
}

/** 초기 로딩 애니메이션 */
.chat-init-enter-active,
.chat-init-leave-active {
  transition: opacity 0.4s ease-in-out;
}

.chat-init-enter-from,
.fchat-init-leave-to {
  opacity: 0;
}

/** 번역 애니메이션 */
.fade-translate-enter-active,
.fade-translate-leave-active {
  transition: opacity 0.4s ease-in-out;
}

.fade-translate-enter-from,
.fade-translate-leave-to {
  opacity: 0;
}

/** 공지 표시/숨김 애니메이션 */
.announcement-enter-active,
.announcement-leave-active {
  transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
  transform-origin: top;
}

.announcement-enter-from,
.announcement-leave-to {
  opacity: 0;
  transform: scaleY(0.8) translateY(-10px);
}

.announcement-enter-to,
.announcement-leave-from {
  opacity: 1;
  transform: scaleY(1) translateY(0);
}

// 고정 공지 스타일
.custom-announcement {
  display: flex;
  justify-content: space-between;
  align-items: center;
  cursor: pointer;
  background-color: var(--bg-notice, rgba(19, 152, 127, 0.08));
  border-radius: 8px;
  border: 1px solid var(--bg-notice, rgba(19, 152, 127, 0.2));
  margin: 0;
  height: 34px;
  line-height: 36px;
  transition: all 0.3s ease-in-out;
  z-index: 10;
}

.announcement-hover {
  background-color: var(--bg-notice-hover, rgba(19, 152, 127, 0.14));
}

/**! ait 폰트 색상 대체 */
:deep(#aitSpan) {
  @apply text-inherit cursor-pointer;
}

/** 텍스트 선택 가능을 보장하는 공통 클래스 */
.select-text {
  user-select: text !important;
  -webkit-user-select: text !important;
  -moz-user-select: text !important;
  -ms-user-select: text !important;
  -khtml-user-select: text !important;
}

/** 기본적으로 바깥쪽은 선택 금지하여 공백 영역이 선택되는 것을 방지, 구체적인 내용 요소에서 별도로 활성화 */
.chat-message-max-width {
  user-select: none;

  .bubble,
  .bubble-oneself,
  .translated-text,
  .select-text {
    user-select: text;
    -webkit-user-select: text;
  }
}

/* 데스크톱 전역: 메시지 컨테이너 선택 금지, 말풍선 내부만 선택 허용하여 mac WebKit에서 드래그 시 상하 padding까지 색상이 번지는 것 방지 */
:global(#image-chat-main .message-list) {
  user-select: none;
  -webkit-user-select: none;
}

:global(#image-chat-main .message-list .bubble),
:global(#image-chat-main .message-list .bubble-oneself),
:global(#image-chat-main .message-list .translated-text),
:global(#image-chat-main .message-list .select-text),
:global(#image-chat-main .message-list .reply-bubble),
:global(#image-chat-main .message-list .emoji-reply-bubble) {
  user-select: text;
  -webkit-user-select: text;
}